---
title: Handsontable 在Vue项目中实现Excel
date: 2021-05-25 14:27:01
permalink: /pages/sseaeewweeew
author: 
  name: jeffery
categories: 
  - 项目
  - 自定义打印
  - 插件
tags: 
  - 自定义打印
  - 插件
---

# Handsontable 在Vue项目中实现Excel

## 前言

在开发自定义打印功能时候，需要在线生成 `Excel`，最开始中意的是 `SpreadJS在线表格编辑器_可自定制的，在线Excel`这个，但是因为其是收费产品，最后选择了--- `Handsontable` 这个js插件， 它是一款很接近 `excel` 的前端表格插件，在这里记录一下使用说明

[Handsontable](https://link.jianshu.com/?t=https%3A%2F%2Fdocs.handsontable.com%2F0.35.1%2Ftutorial-introduction.html) 官方文档

::: warning
Handsontable API 的使用要以项目的版本为准，不同的版本API可能不兼容，推荐先查看项目的当前使用版本，阅读官方文档
:::

## 安装

```bash
npm i handsontable @handsontable/vue --save

// 或者
yarn add handsontable @handsontable/vue
```

## 使用

```js
//第一种方式
<hot-table :settings="secondColumnSettings" :data="hotData"></hot-table>


//第二种方式
<hot-table :data="hotData" :settings="secondColumnSettings">
  <hot-column title="First column header">
  </hot-column>
  <hot-column title="seconed">
  </hot-column>
</hot-table>

// 第三种方式
var data = [
  ["", "Ford", "Volvo", "Toyota", "Honda"],
  ["2016", 10, 11, 12, 13],
  ["2017", 20, 11, 14, 13],
  ["2018", 30, 15, 12, 13]
];

var container = document.getElementById('example');
var hot = new Handsontable(container, {
  data: data,
  rowHeaders: true,
  colHeaders: true,
  });
```



## api参数配置说明

```js
let setting = {
  width: '100%', //表格的宽度

  height: 470, //表格的高度 设置了才会出现scroll

  data: [],       //表格数据，可以是二维数组，也可以是数组对象

  className: "htCenter htMiddle", //垂直水平居中

  colWidths: 55, //每列的宽度 可以是数字，也可以是函数

  rowHeights: 35, //每行的高度 可以是数字，也可以是函数

  startRows: 11,//行列范围
  startCols: 6,
  minRows: 5,  //最小行列
  minCols: 5,
  maxRows: 20,  //最大行列
  maxCols: 20,

  //fixedRowsTop: 2,  // 固定上边列数

  //fixedColumnsLeft: 3, // 固定左边列数

  rowHeaders: true,//行表头，可以使布尔值（行序号），可以使字符串（左侧行表头相同显示内容，可以解析html），也可以是数组（左侧行表头单独显示内容）。
        
  colHeaders:   [ '题目', 'A选项', 'B选项', 'C选项', 'D选项','答案'], //自定义列表头or 布尔值
  
  minSpareCols: 2, //列留白
  minSpareRows: 2,//行留白

  currentRowClassName: 'currentRow', //为选中行添加类名，可以更改样式
        
  currentColClassName: 'currentCol',//为选中列添加类名
        
  autoWrapRow: true, //自动换行

  // mergeCells: true, //表示允许单元格合并

  mergeCells: [   //合并
    {row: 1, col: 1, rowspan: 3, colspan: 3},  //指定合并，从（1,1）开始行3列3合并成一格
    {row: 3, col: 4, rowspan: 2, colspan: 2}
  ],

  manualColumnMove: true, // 手动移动列

  manualRowMove: true, // 手动移动行

  manualColumnResize: true, // 手工更改列距

  manualRowResize: true, // 手动更改行距

  autoColumnSize: false, //当值为true且列宽未设置时，自适应列大小

  columnSorting: false, // 排序

  stretchH: 'all',//根据宽度横向扩展，last:只扩展最后一列，none：默认不扩展

  contextMenu: true, //右键菜单

  comments: true, //添加注释

  copyable: true, // 允许键盘复制

  dropdownMenu: true, //头部是否显示menu

  cell: [
    {row: 1, col: 1, comment: {value: 'this is test'}},
  ],

  customBorders:[ // 自定义边框
    {
      range:{
        from:{row:行数,col:列数},
        to:{row:行数,col:列数},上下左右设置
        }
    }
  ],

    contextMenu: {    //右键效果，内容部分的menu 对功能汉化
      items: {
          'row_above': {
            name: '上方插入一行'
          },

          'row_below': {
            name: '下方插入一行'
          },

          "col_left": {
            name: '左方插入列'
          },

          "col_right": {
            name: '右方插入列'
          },

          "remove_row": {
            name: '删除行',
          },

          "remove_col": {
            name: '删除列',
          },

          "make_read_only": {
              name: '只读',
          },

          "borders": {
            name: '表格线',
          },

          "commentsAddEdit": {
            name: '添加备注',
          },

          "commentsRemove": {
            name: '取消备注',
          },

          "freeze_column": {
            name: '固定列',
          },

          "unfreeze_column": {
            name: '取消列固定',
          },

          'clear_custom': {
            name: '清除数据',
            callback: function() {
                this.clear();
            }
          }
      }
  },

  renderer: function(instance, td, row, col, prop, value, cellProperties) {
      // 渲染为text类型，可选的有TimeRenderer、PasswordRenderer等不同的类型
      Handsontable.renderers.TextRenderer.apply(this, arguments);

      // 判断条件
      if (row === 0 || row === 1 || row === 2) {
          td.style.backgroundColor = '#e0ecff';
          // 此处可以单独渲染某行或某列 根据条件渲染 比如背景色 字体、颜色、粗细等等
      }
  },

  afterChange: function(changes, source) {     //数据改变时触发此方法 捕捉数据更改
    console.log(this.getData(), '/', changes, '/', source);
  }
}
```

**完整示例**

```html
import { HotTable } from '@handsontable-pro/vue'
import '../../node_modules/handsontable-pro/dist/handsontable.full.css'
import Handsontable from 'handsontable-pro'

<template>
  <div>
    <div id="hotTable" class="hotTable">
        <HotTable :root="root" ref="testHot" :settings="hotSettings"></HotTable>
     </div>
  </div>
</template>

  <script>
export default {
  data: function () {
    return {
      root: 'test-hot',
      hotSettings: {
        data: [        //数据可以是二维数组，也可以是数组对象
          ['20080101', 10, 11, 12, 13,true],
          ['20090101', 20, 11, 14, 13,true],
          ['20010101', 30, 15, 12, 13,true],
          ['20010101', 32, 213, 21, 312,true],
          ['20010201', 32, 213, 21, 312,true],
          ['20010301', 32, 213, 21, 312,true],
          ['20010401', 32, 213, 21, 312,true],
          ['20010501', 32, 213, 21, 312,true],
          ['20010601', 32, 213, 21, 312,true]
        ],
        startRows: 11,//行列范围
        startCols: 6,
        minRows: 5,  //最小行列
        minCols: 5,
        maxRows: 20,  //最大行列
        maxCols: 20,
        rowHeaders: true,//行表头，可以使布尔值（行序号），可以使字符串（左侧行表头相同显示内容，可以解析html），也可以是数组（左侧行表头单独显示内容）。
        colHeaders:   [ '题目', 'A选项', 'B选项', 'C选项', 'D选项','答案'],//自定义列表头or 布尔值
        minSpareCols: 2, //列留白
        minSpareRows: 2,//行留白
        currentRowClassName: 'currentRow', //为选中行添加类名，可以更改样式
        currentColClassName: 'currentCol',//为选中列添加类名
        autoWrapRow: true, //自动换行
        contextMenu: {   //自定义右键菜单，可汉化，默认布尔值
          items: {
            "row_above": {
              name:'上方插入一行'
            },
            "row_below": {
              name:'下方插入一行'
            },
            "col_left": {
              name:'左方插入列'
            },
            "col_right": {
              name:'右方插入列'
            },
            "hsep1": "---------", //提供分隔线
            "remove_row": {
              name: '删除行',
            },
            "remove_col": {
              name: '删除列',
            },
            "make_read_only": {
              name: '只读',
            },
    { type: 'numeric', format: '$ 0,0.00'},  //指定的数据格式
    {type: 'checkbox'},  //多选框
  ],
    afterChange: function (changes, source) { //数据改变时触发此方法
      console.log(this.getData())；
    },
    manualColumnFreeze: true, //手动固定列
    manualColumnMove: true, //手动移动列
    manualRowMove: true,   //手动移动行
    manualColumnResize: true,//手工更改列距
    manualRowResize: true,//手动更改行距
    comments: true, //添加注释
    cell: [
      {row: 1, col: 1, comment: {value: 'this is test'}},
    ],
    customBorders:[],//添加边框
    columnSorting: true,//排序
    stretchH: 'all',//根据宽度横向扩展，last:只扩展最后一列，none：默认不扩展
  }
  };
  },
    name: 'handsonTable',
      components: {
      HotTable
    },
    methods: {
      saveData (){
        var examData = this.$refs.testHot.table.getData(); //这里要注意，如果使用this.hotSettings.data 保存表格数据，拖拽完以后数据的顺序将不会更新，因此使用 this.$refs.testHot.table.getData(); 来获取数据，获取的数据格式为二维数组。
        console.log(examData );
      }
    }
  }
  </script> 
```


## handsontable 事件api

**1、为handsontable添加钩子方法**

addHook(key,callback): key为钩子方法名

例如：

```js
hot.addHook('beforeInit', myCallback);
```

addHookOnce(key,callback)：添加只使用一次的方法，用完后自动删除

例如：
```js
hot.addHookOnce('beforeInit', myCallback); 
```

**2.clear():清空表格数据**

**3.colOffset():获取可见的第一列的索引值**

**4.deselectCell():取消当前被选中的单元格**

**5.destory():移除dom对象中的表格**

**6.destoryEditor(reverOriginal)**

去除当前编辑器，并选中当前单元格，渲染上该效果。如果reverOriginal不是true则被编辑的数据将被保存，如果为true，则会恢复之前的数据，不保存新的数据到单元格。

**7.getCell(row.col,topmost):**

根据行列索引，获取一个被渲染的单元格，如果该单元格未被渲染则返回null

其中，row,col分别为行索引和列索引，topmost为表示是否是最上层，其值为true/false

**8.getCellEditor():获取单元格的编辑器**

 **9.getCellMeta(row,col):根据行列索引获取单元格的属性对象**

 **10.getCellRenderer(row,col)：根据单元格的行列索引获取单元格的渲染函数**

 **11.getColHeader(col):根据列索引获取列头名称**

**12.getRowHeader(row):根据行索引获取行头名称**

**13.getColWidth(col):根据列索引获取列宽**

**14.getRowHeight(row):根据行索引获取行高**

**15.getCoords(elem):获取元素的坐标**

**16.getCopyableData(startRow,startCol,endRow,endCol):获取指定范围的单元格数据**

**17.getData(row1,col1,row2,col2):获取指定范围的单元格的数据**

**18.getDataAtCell(row,col):根据行列索引获取单元格的值**

**19.getDataAtCol(col)：根据列索引获取一列的数据**

**20.getDataAtRow(row)：根据行索引获取一行的数据**

**21.getDataAtProp(prop):根据对象属性名获取相应的列的数据,prop为属性名**

**22.getDataAtRowProp(row,prop):根据行索引返回指定属性名的值**

**23.getInstance():获取一个handsontable实例**

**24.getPlugin(pluginName):根据插件名称获取一个插件实例**

**25.getSelected():获取被选中的单元格的索引数组，数组包括：startRow，stratCol，endRow，endCol4个值。**

 **26.getSelectedRange():获取被选中的单元格的坐标**

**27.getSettings():获取对象的配置信息**

**28.getSourceDataAtCol(col):根据列号获取data source中的该列数据**

**29.getSourceDataAtRow(row):根据行号获取data source中的该行数据**

**30.getValue():获取所有被选中的单元格的值**

**31.hasColHeaders():返回是否存在列头**

**32.hasRowHeaders():返回是否存在行头**

**33.isEmptyCol(col):根据列索引判断该列是否为空**

**34.isEmptyRow(row):根据行索引判断该行是否为空**

**35.isListening():判断当前handsontable实例是否被监听**

**36.loadData(data)：加载本地数据**

**37.populateFormArray(start,input,end,source,method,direction,deltas):**

使用二维数组填充单元格，其中：

​      start:开始位置

​      input：二维数组

​      end：结束位置

​      source：默认为populateFromArray

​      method：默认为overwrite

​      direction：left/right/top/bottom

​      deltas:其值为一个数组

 

**38.propToCol(prop):返回给定属性名的列索引，prop为属性名**

**39.propToRow(prop):返回给定属性名的行索引，prop为属性名**

**40.removeCellMeta(row,col,key):根据行列索引移除指定的属性对象**

**41.removeHook(key,callback):移除钩子方法**

**42.render():渲染表格**

**43.rowOffset():获取第一个可见行的索引**

**44.setCellMeta(row,col,key,val)：设置参数属性和值到指定行列的单元格**

**45.setCellMetaObject(row,col,prop):设置属性对象到指定的单元格**

**46.setDataAtCell(row,col,value,source)：设置某个单元格的数据**

row：行号索引

col：列号索引

value：将要设置的单元格数据

source（可选）：字符串标识中描述这一变化将如何改变数组(用于onAfterChange或onBeforeChange回调)

也可使用数组参数，如下：

```
hot.setDataAtCell([
	[9, 0, 'a'], // row col value
	[9, 1, 'b']
]);
```

**47.setDataAtRowProp(row,prop,value,source):设置指定行的属性值为指定的值**

与**setDataAtCell**不同的是数据源格式，**setDataAtCell**是使用二维数组做数据源，**setDataAtRowProp**是以对象数组做数据源，两个的功能实际上是一样的。

**48.updateSettings(setting,init)：修改初始化的配置信息**

**49.validdateCells(callback):使用验证器验证所有单元格**

**50.createCol(index,amount,createAutomatically)：添加列**

​    *index**：列索引，amount**：添加的列总数，createAutomatically**：为一个数字*

**51.removeCol(index,amount):删除列**

**52createRow(index):添加行**

**53removeRow(index,amount)：删除行**

**54.get(row,prop)：根据行号和属性索引获取单元格的值**

**55.getAll():获取所有的数据**

**56.getCopyable(row,prop):根据行号和属性索引获取单个单元格的值**

**57.getCopyableText(start,end):获取被选择位置的值**

​    *satrt**：开始选择的位置对象，end**：结束选择的位置对象*

**58.getRange(start,end,destination):根据坐标获取数据**

satrt：开始选择的位置对象，
end：结束选择的位置对象，
destionation**：目的地map索引

**59.getText(start,end)：获取目标位置的数据**
  
**60.set(row,prop,value,source)：设置单个单元格的值**

row:行索引，
prop：列索引，
value：新值，
source：hook插件的提供者

**59.spliceCol(col,index,amount):添加或移除列数据**

  col:列索引，
  index：开始改变的数组索引，
  amount：改变数据的个数

**60.spliceRow(row,index,amount)：添加或删除行数据**

row:行索引
index：开始改变的数组索引，
amount：改变数据的个数


### 其他API

**1）afterChange (changes: Array, source: String)：1个或多个单元格的值被改变后调用**

changes：是一个2维数组包含row，prop，oldVal，newVal4个属性。

source：其值为一个字符串，值可以为：`alter，empty，>populateFromArray，loadData，autofill，paste`

**2）beforeChange (changes: Array, source: String)：开始改变单元格前被调用**

changes：是一个2维数组，包括[row，prop，oldVal，newVal]这4个公共属性列

source是被改变的资源的名称

**3）afterCellMetaReset ()：重置单元格后调用**

**4）afterColumnMove (oldIndex: Number, newIndex: Number)：列顺序被>>移动后触发**

**5）afterRowMove (oldIndex: Number, newIndex: Number)：行被移动后调>用**

**6）afterRowResize (col: Number, size: Number)：行高改变后调用**

**7）afterRemoveCol (index: Number, amount: Number)：当一列或多列被>移动后调用**

其中，index为开始移动的列的索引，amount为移动的列的总数量

**8）afterRemoveRow (index: Number, amount: Number)：当一行或多行被>移动后调用**

其中，index为被移动的行的索引，amount为被移动的行的总数量

**9）beforeRemoveCol (index: Number, amount: Number)：一列或多列被>>移动前调用beforeRemoveRow (index: Number, amount: Number)：一行或>多行被移动前被调用**

**10）afterColumnSort (column: Number, order: Boolean)：列排序后调用**

**11）beforeColumnSort (column: Number, order: Boolean)：列排序前被调用**

order：值为true时为升序，false时为降序

**12）afterCreateCol (index: Number, amount: Number)：添加行后被调用**

index：新列的索引

amount：新列的数目

**13）afterCreateRow (index: Number, amount: Number)：添加行后被调用**

index:新行的索引

amount：新行的数目

**14）afterGetCellMeta (row: Number, col: Number, cellProperties: >Object)：获取单元格的配置信息后被调用**

**15）beforeGetCellMeta (row: Number, col: Number, cellProperties: >Object)：获取单元格属性前被调用**

**16）afterSetCellMeta(row: Number, col: Number, key: String, value: *)：单>元格样式被改变后调用**

其中，cellProperties是一个单元格的渲染对象，key是改变样式的方式，例>如合并单元格（merge），水平对齐（align）等。

**17）afterGetColHeader (col: Number, TH: DOM Node)：获取列头信息后被>调用，TH是行头节点**

**18）afterGetColWidth (col: Number, response: Object)：获取列宽后被调用**

**19）afterColumnResize (col: Number, size: Number)：列宽度被手动修改后调用**

**20）afterCopyLimit (s-electedRowsCount: Number, s-electedColsCount: Number,copyRowsLimit: Number, copyColsLimit: Number)**

当 copyRowsLimit 或者 copyColumnsLimit实现时被调用

**21）afterDestroy ()：销毁Handsontable实例后被调用**

**22）afterInit ()：Handsontable实例被初始化后调用**

**23）beforeInit ()：Handsontable实例被初始化前调用**

**24）beforeInitWalkontable()：Walkontable实例被初始化前调用**

**25）afterLoadData ()：新的数据被加载到数据资源后被调用afterOnCellCornerMouseDown (event)：鼠标点击单元格边角后被调用**

**26）afterOnCellMouseDown (event: Object, coords: Object, TD: Object)：>点击单元格或行头/列头后被调用**

注意：点击行头或列头后索引的坐标为负数。例如点击列头单元格(0,0)，则>调用后的坐标为(0,-1)。

**27）afterOnCellMouseOver (event: Object, coords: Object, TD: Object)：鼠标>停悬在单元格或行头/列头后调用**

注意：点击行头或列头后索引的坐标为负数。例如点击行头单元格(0,0)，>则调用后的坐标为(0,-1)。

**28）afterRender (isForced: Boolean)：渲染表格后被调用**

isForced：当其值为true表示是通过改变配置或数据引起的渲染，当值为>false时表示通过滚动或移动、选中引起的渲染

**29）beforeRender (isForced: Boolean)：渲染前被调用**

**30）afterRenderer (TD: Object, row: Number, col: Number, prop: String, >value: String, cellProperties: Object)：手动渲染后调用**

**31）beforeChangeRender ()：渲染被改变前调用**

**32）afterDes-elect ()：当前单元格被取消选中时调用**

**33）afterS-election (r: Number, c: Number, r2: Number, c2: Number)：当>一个或多个单元格被选中后调用**

其中，r：选中的单元格起始行，r2：选中单元格的终止行

c：选中的单元格的起始列，c2：选中的单元格的终止列

**34）afterS-electionByProp (r: Number, p: String, r2: Number, p2: String)：>通过属性名选中单元格后调用afterS-electionEnd (r: Number, c: Number, r2: >Number, c2: Number)：选中单元格鼠标抬起后调用**

afterS-electionEndByProp (r: Number, p: String, r2: Number, p2: String)：通>过属性选中单元格鼠标抬起后调用

**35）afterUpdateSettings ()：配置参数配修改后调用**

**36）afterValidate (isValid: Boolean, value: Mixed, row: Number, prop: >String,source: String)**

当有验证器的时候调用验证器时被调用，验证结果作为第一个参数。

**37）beforeValidate (value: Mixed, row: Number, prop: String, source: >String)：验证器被调用前调用该事件**

**38）beforeAutofill (start: Object, end: Object, data: Array)：开始自动填充前调动**

start：是一个第一个填充的单元格对象，例如:{row:4,col:3}

end：是最后一个填充的单元格对象，例如：{row:7,col:5}

data:是一个2维数组

**39）beforeKeyDown (event: Object)：按键按下前被调用**

**40）beforeSet (var: Object)：单个配置值被设置前调用**
**41）beforeSetRangeEnd(coords: Array)：设置范围结束前被调用**

coords：是范围坐标

**42）modifyCol(col: Number)：列被修改时调用**

**43）modifyRow( row: Number)：行被修改时调用**

**44）modifyColWidth (width: Number, col: Number)：列宽被修改时调用**

**45）modifyRowHeight (height: Number, row: Number)：行高被修改时调用**


## 参考资料

- [博客园随笔分类 - Handsontable](https://www.cnblogs.com/QiuJL/category/1014845.html)

- [Handsontable 使用](https://blog.csdn.net/MarseilleEE/article/details/53433962)

- [handsontable常规配置的中文API](https://blog.csdn.net/mafan121/article/details/46050049)

- [handsontable自定义渲染](https://www.cnblogs.com/QiuJL/p/6972327.html)

- [怎样实现handsontable双击修改列头](https://blog.csdn.net/u012414590/article/details/52841103)

- [handsontable合并项mergeCells应用及扩展](https://www.cnblogs.com/senyier/p/7298167.html)

- [handsontable-github](https://github.com/handsontable)

- [Handsontable 学习笔记-Methods  一些小的方法的使用](https://www.cnblogs.com/ibgo/p/4770703.html)

- [用（bootstrap）Handsontable做表格，手动实现数据排序](https://www.cnblogs.com/blackheartinsunshine/p/5085662.html)

- [handsontable的核心方法](https://www.cnblogs.com/sily-boy/p/4761011.htmll)

- [handsontable一个Excel一样的外观数据网格组件](https://blog.csdn.net/qianqianyixiao1/article/details/51329523)

- [handsontable的核心方法](https://blog.csdn.net/mafan121/article/details/46122577)

- [Handsontable对单元格的操作](https://blog.csdn.net/mafan121/article/details/46119905)

- [web前端仿Excel表格编辑组件Handsontable](http://blog.sina.com.cn/s/blog_56b616c80102w37d.html)