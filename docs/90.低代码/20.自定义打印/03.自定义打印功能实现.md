---
title: 自定义打印功能实现
date: 2020-06-15 20:45:35
permalink: /pages/seeelee31ef7
author: jeffery
categories: 
  - 自定义打印模块
  - 低代码
tags: 
  - 自定义打印模块
  - 低代码
---

# 自定义打印功能实现


## 自定义打印设置

自定义打印设置主要分为四个部分：**字段拖拽组件**、**工具栏组件**、**页面按钮组件**、**渲染表格组件**

![image-20210809172809967](https://gitee.com/FIF/pic-beg/raw/master/images/lowcode/image-20210809172809967.png)


## 表单字段&系统字段

字段拖拽区域分为表单字段和系统字段，表单字段又划分为内容和标题两部分

|                        表单字段-内容                         |                        表单字段-标题                         |
| :----------------------------------------------------------: | :----------------------------------------------------------: |
| ![image-20210809174728859](https://gitee.com/FIF/pic-beg/raw/master/images/lowcode/image-20210809174728859.png) | ![image-20210809174757045](https://gitee.com/FIF/pic-beg/raw/master/images/lowcode/image-20210809174757045.png) |

### 实现逻辑

表单字段和系统字段是两个按钮，默认显示表单字段
- 表单字段是动态数据，根据表单的字段显示，包括内容和标题两部分
- 系统字段包括自定义的固定的字段，比如评论、提单人、提单时间等

**拖拽事件**

完成这个功能主要用了以下几个事件，[拖拽事件介绍参考这篇文章](https://jefferyxzf.github.io/jeffery-blog/pages/seedseegg/)

| 事件      | 功能    |
|----------- |-------- |
| dragstart | 开始拖拽 | 
| dragend | 拖拽释放 | 
| dragover | 拖拽悬浮【目标元素】 | 
| dragenter | 拖拽进入【目标元素】 |
| drop | 拖拽释放【目标元素】 | 

使用原生拖拽事件实现，在标签添加 `draggable` 属性，在按钮上添加 `dragstart` 和 `dragend` 事件

```html
<div
   draggable="true"
   @dragstart="drag($event,item)"
   @dragend="end($event)"
 >
  [内容] {{ item.label }}
</div>
```

**dragstart 的实现** 

开始拖拽的时候，清空当前选中的单元格，将拖拽的信息存储到对象上
```js
drag (event, prop, parent, isTitle) {
      this.clearCurrentCell()
      this.dom = { field: prop, parent: parent, isTitle: isTitle } 
},
clearCurrentCell: function () {
      this.currentCell = null
}
```


通过html2canvas的方法将canvas和表单内容提取出并转成图片，canvas内容不会丢失




## 拓展阅读

- [web打印，一篇搞定](https://alexwjj.github.io/pages/bc7fdbb035246/)