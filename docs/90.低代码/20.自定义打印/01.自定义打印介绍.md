---
title: 自定义打印介绍
date: 2020-06-12 19:45:35
permalink: /pages/sdsel3lee31ef7
author: jeffery
categories: 
  - 自定义打印模块
  - 低代码
tags: 
  - 自定义打印模块
  - 低代码
---

# 自定义打印介绍

## 背景

在很多企业的业务场景，企业希望将填写表单的数居打印出来，并且可以设置打印的样式，根据企业的需求可以设置不同的打印模板

## 技术选型

产品设计是参考[简道云的自定义打印](https://hc.jiandaoyun.com/doc/9140)，左边是可以拖拽的字段面板，通过拖拽字段到 `excel` 表格单元格上打印，所以需要在一个表格上渲染显示数据，根据网上的调研，有以下几种方案实现：


- [SpreadJS](https://www.grapecity.com.cn/developer/spreadjs)：功能很丰富，但是收费很贵，按照开发人数收费，公司没有考虑
- [handsontable](https://github.com/handsontable/handsontable)：开源项目，高级功能需要付费，好在基本功能可以满足目前的功能，不过需要在这基础上进行二次开发
- [Luckysheet](https://github.com/mengshukeji/Luckysheet)：国产完全开源的项目，功能也非常的丰富，迭代很快


有点可惜，Luckysheet 项目开源的时间比较晚，当时开发时候还没有出来，所以没有用到公司项目上，最终使用的是 handsontable 项目。

数据渲染有了，那怎么转化为 pdf 文件下载并使用打印机打印呢？

通过github和网上搜索，比较成熟的方案是使用 [html2canvas](https://github.com/niklasvh/html2canvas) 和 [jsPDF](https://github.com/MrRio/jsPDF) 插件，通过 html2canvas 把页面转化为画布图像，然后利用 jsPDF 将图像转化为 pdf 文件


## 功能介绍

### 设计页面

- 字段拖拽区域：可以将表单字段【内容】、表单字段【标题】、系统字段拖动到画布的指定位置
- 页面操作按钮：重置后端模板、操作（恢复默认模板、清空）、预览和保存自定义打印模板
- 工具栏：修改画布的样式，包括撤销恢复、设置字体大小、边框、对齐、合并单元格、设置图片显示比例、水印设置、子表单打印设置等
- 渲染区域：拖拽字段渲染的区域，或数据填充渲染的区域

![image-20210809172809967](https://gitee.com/FIF/pic-beg/raw/master/images/lowcode/image-20210809172809967.png)



### 表单字段&系统字段

- 左侧表单字段，包括内容和标题两部分，因为字段是由这两部分组成的

|                        表单字段-内容                         |                        表单字段-标题                         |
| :----------------------------------------------------------: | :----------------------------------------------------------: |
| ![image-20210809174728859](https://gitee.com/FIF/pic-beg/raw/master/images/lowcode/image-20210809174728859.png) | ![image-20210809174757045](https://gitee.com/FIF/pic-beg/raw/master/images/lowcode/image-20210809174757045.png) |


- 左侧系统字段，包括提交人、打印时间、评论等系统字段

![image-20210809175025914](https://gitee.com/FIF/pic-beg/raw/master/images/lowcode/image-20210809175025914.png)

- 列表中的字段内容表示字段值。见下图，把「日期字段」字段放至设计界面后，显示为「${日期字段}」。也就是说B2这个单元格代表的是，某条数据中日期字段的值，如“2020-06-06”

![image-20210809175522806](https://gitee.com/FIF/pic-beg/raw/master/images/lowcode/image-20210809175522806.png)

- 为了表示数据代表的意思，通常可以在字段值前面或者上面加上标题

![image-20210809175703340](https://gitee.com/FIF/pic-beg/raw/master/images/lowcode/image-20210809175703340.png)

### 菜单工具栏

（1）功能介绍

![image-20210809181210939](https://gitee.com/FIF/pic-beg/raw/master/images/lowcode/image-20210809181210939.png)



- 如果要取消边框线，在选中单元格后点击「边框线中的无边框」或者「边框线粗细中的无边框」。



![image-20210809182425770](https://gitee.com/FIF/pic-beg/raw/master/images/lowcode/image-20210809182425770.png)

![image-20210809182449799](https://gitee.com/FIF/pic-beg/raw/master/images/lowcode/image-20210809182449799.png)

（2）纸张设置

- 设置纸张大小，方向。注意参考线标注了打印时的边界，设计时不要超出，以免影响打印效果。
- 系统预设了几种常见的纸张大小，如A3,A4，也可以根据需要自定义纸张大小。



![image-20210809182517956](https://gitee.com/FIF/pic-beg/raw/master/images/lowcode/image-20210809182517956.png)

（3）参考线

- 参考线标注了打印范围，位于参考线之内的内容可以被打印出来。

> 注意：参考线和实际打印边界，并不是完全重合的，会存在不一致的情况。参考线标注的范围 始终<= 实际打印范围

![image-20210809182912979](https://gitee.com/FIF/pic-beg/raw/master/images/lowcode/image-20210809182912979.png)



（4）插入图片和背景图片

- 可上传背景图，注意先将图片调整至与纸张长宽比例一致再上传，这样可以等比例缩放填充纸张。打印背景开启后，打印时才会将背景图片一并打印出来

- 可在单元格中插入图片，打印出来。常见用法如插入公司logo等; 插入图片之后，可以通过改变单元格大小来调整图片大小，也可以设置图片比例。

![image-20210809183136672](https://gitee.com/FIF/pic-beg/raw/master/images/lowcode/image-20210809183136672.png)

（5）修改单元格打印的样式

![image-20210809183529174](https://gitee.com/FIF/pic-beg/raw/master/images/lowcode/image-20210809183529174.png)

### 打印页面展示

![image-20210809182217917](https://gitee.com/FIF/pic-beg/raw/master/images/lowcode/image-20210809182217917.png)



### 打印功能的局限

- 不支持批量打印
- 不支持数据选择范围打印，比如流程设置打印
- 合并单元格打印有可以出现样式偏差，IOS移动端样式不兼容的问题（插件限制）
- 图片字段多图片渲染的性能问题