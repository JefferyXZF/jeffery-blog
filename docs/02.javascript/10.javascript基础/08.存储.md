---
title: 存储
date: 2020-01-05 15:17:01
permalink: /pages/sewe3erwerwdasweew
author: 
  name: jeffery
categories: 
  - javascript
tags: 
  - javascript
---

# 存储



## Cookie



### 标识

浏览器默认打开 `Cookie`功能。`window.navigator.cookieEnabled` 属性返回一个布尔值，表示浏览器是否打开 `Cookie`功能

```js
console.log(window.navigator.cookieEnabled);//true
```

可以通过浏览器的一些设置将cookie功能关闭

![img](https://gitee.com/FIF/pic-beg/raw/master/images/javascript/js_storage_cookie1.png)

```js
console.log(window.navigator.cookieEnabled);//false
```

此时，客户端本地将不再存储任何cookie

 

### 限制

由于 `cookie` 是存在客户端计算机上的，还加入了一些限制确保 `cookie`不会被恶意使用，同时不会占据太多磁盘空间。每个域的 `cookie` 总数是有限的，不过浏览器之间各有不同。如下所示

- IE6-浏览器限制每个域名最多20个cookie

- IE7+浏览器限制每个域名最多50个。IE7最初是支持每个域名最大20个cookie，之后被微软的一个补丁所更新

- Firefox限制每个域最多50个cookie

- Opera限制每个域最多30个cookie

- Safari和Chrome对于每个域的cookie数量限制没有硬性规定

当超过单个域名限制之后还要再设置 `cookie`，浏览器就会清除以前设置的`cookie`。IE和Opera会删除最近最少使用过的(LRU, LeastRecentlyUsed) `cookie`，腾出空间给新设置的cookie。Firefox看上去好像是随机决定要清除哪个 `cookie`，所以考虑 `cookie` 限制非常重要，以免出现不可预期的后果

浏览器中对于 `cookie` 的尺寸也有限制。大多数浏览器都有大约 `4096B(加减1)` 的长度限制。为了最佳的浏览器兼容性，最好将整个 `cookie` 长度限制在 `4095B(含4095)` 以内。尺寸限制影响到一个域下所有的`cookie` ，而并非每个 `cookie` 单独限制

如果尝试创建超过最大尺寸限制的 `cookie` ，那么该 `cookie` 会被悄无声息地丢掉。注意，虽然一个字符串常占用一字节，但是多字节情况则有不同

【同源】

两个网址只要域名相同和端口相同，就可以共享 `Cookie`。注意，这里不要求协议相同

也就是说，`http://example.com` 设置的Cookie，可以被`https://example.com`读取

### 读取

通过 `document.cookie` 属性可以获取 `cookie` 的值，其返回值是一个字符串，该字符串都是由一系列名值对儿组成，不同名/值对之间通过“分号和空格”分开

```js
document.cookie = "name=match; domain=127.0.0.1; path=/test";
console.log(document.cookie);//'age=32; name=match'
```

### 设置

当用于设置值的时候，`document.cookie` 属性可以设置为一个新的 `cookie` 字符串

```js
document.cookie = "name=Nicholas";
```

## Web Storage

`Web Storage` 的目的是克服由 `cookie` 带来的一些限制，当数据需要被严格控制在客户端上时，无须持续地将数据发回服务器。`Web Storage` 的两个主要目标是：提供一种在 `cookie之` 外存储会话数据的途径以及提供一种存储大量可以跨会话存在的数据的机制

`Web Storage`分成两类：`sessionStorage`和`localStorage`。

`sessionStorage`保存的数据用于浏览器的一次会话，当会话结束(通常是该窗口关闭)，数据被清空；
`localStorage` 保存的数据长期存在，下一次访问该网站的时候，网页可以直接读取以前保存的数据。

除了保存期限的长短不同，这两个对象的属性和方法完全一样

`Storage` 类型只能存储字符串。非字符串的数据在存储之前会被转换成字符串

### 存取数据

`sessionStorage` 和 `localStorage` 保存的数据，都以“键对”的形式存在。也就是说，每一项数据都有一个键名和对应的值。所有的数据都是以文本格式保存

::: tip
Storage类型只能存储字符串。非字符串的数据在存储之前会被转换成字符串
:::

【setItem()】

存入数据使用 `setItem` 方法。它接受两个参数，第一个是键名，第二个是保存的数据

[注意]不同的浏览器存入的 `Storage` 位置不一样，不能通用

```js
sessionStorage.setItem("key","value");
localStorage.setItem("key","value");
```

【getItem()】

读取数据使用 `getItem` 方法。它只有一个参数，就是键名

```js
var valueSession = sessionStorage.getItem("key");
var valueLocal = localStorage.getItem("key");
```

除了使用 `setItem()` 和 `getItem()` 方法之外，还可以使用属性来存取数据

```js
localStorage.setItem("key1","value1");
localStorage.testkey = 'testvalue';
console.log(localStorage.getItem('testkey'));//'testvalue'
console.log(localStorage.key1);//'value1'
```

### 清除数据

【removeItem()】

`removeItem()`方法用于清除某个键名对应的数据

[注意]清除不存在的键名不会报错，只会静默失败

```js
sessionStorage.removeItem('key');
localStorage.removeItem('key');
```

除了使用 `removeItem()` 方法，还可以使用 `delete` 操作来清除数据

[注意]IE7-浏览器不支持 `delete` 操作符来清除 `storage` 数据

```js
localStorage.setItem("key1","value1");
delete localStorage.key1;
console.log(localStorage.key1);//undefined
console.log(localStorage.getItem('key1'));//null
```

【clear()】

`clear`方法用于清除所有保存的数据

```js
sessionStorage.clear();
localStorage.clear(); 
```

### 遍历操作

【key()】

`key(index)`方法返回 `index` 位置处的值的名字

```js
sessionStorage.setItem("key1","value1");
sessionStorage.setItem("key2","value2");
console.log(sessionStorage.key(0));//'key1'
console.log(sessionStorage.key(1));//'key2'
console.log(sessionStorage.key(2));//null
```

【length】

`length` 属性返回名值对儿的个数

```js
console.log(sessionStorage.length);//2
```

利用 `length` 属性和 `key()` 方法，可以遍历所有的键

```js
for(var i = 0; i < localStorage.length; i++){
    var key = localStorage.key(i);
    var value = localStorage.getItem(key);
}
```

还可以使用 `for-in` 循环来迭代

```js
for(var key in localStorage){
    var value = localStorage.getItem(key);
}
```