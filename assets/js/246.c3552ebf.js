(window.webpackJsonp=window.webpackJsonp||[]).push([[246],{679:function(s,t,n){"use strict";n.r(t);var a=n(11),e=Object(a.a)({},(function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h1",{attrs:{id:"单元测试使用指南"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#单元测试使用指南"}},[s._v("#")]),s._v(" 单元测试使用指南")]),s._v(" "),n("p",[s._v("单元测试是针对程序的最小单元来进行正确性检验的测试工作。程序单元是应用的最小可测试部件。一个单元可能是单个程序、类、对象、方法等。")]),s._v(" "),n("h2",{attrs:{id:"适用范围"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#适用范围"}},[s._v("#")]),s._v(" 适用范围")]),s._v(" "),n("p",[s._v("约定针对项目中满足以下条件的函数、组件进行单元测试：")]),s._v(" "),n("ul",[n("li",[s._v("输入值、输出值都确定的函数方法")]),s._v(" "),n("li",[s._v("不涉及数据请求、功能粒度小且相对独立的组件")])]),s._v(" "),n("h2",{attrs:{id:"相关工具"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#相关工具"}},[s._v("#")]),s._v(" 相关工具")]),s._v(" "),n("p",[s._v("项目集成的断言库为 "),n("code",[s._v("Jest")]),s._v(" ，用法参考官方文档：https://jestjs.io/docs/en/using-matchers\n接口请求相关模拟可以使用  "),n("code",[s._v("sinon")]),s._v("  ，用法参考文档：https://www.jianshu.com/p/013ab78b92fd\n开发过程中踩坑，请参考文档：https://blog.csdn.net/duola8789/article/details/80434962")]),s._v(" "),n("h2",{attrs:{id:"文件目录"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#文件目录"}},[s._v("#")]),s._v(" 文件目录")]),s._v(" "),n("p",[s._v("单元测试文件存放于在项目 "),n("code",[s._v("test/unit/specs")]),s._v(" 目录下，以 "),n("code",[s._v("xxx.spec.js")]),s._v(" 命名。同一模块下的组件，使用统一的目录存放，如针对应用开发模块组件的单元测试，则置于 "),n("code",[s._v("test/unit/specs/application")]),s._v(" 目录下")]),s._v(" "),n("p",[s._v("目录结构如下：")]),s._v(" "),n("ul",[n("li",[s._v("test")]),s._v(" "),n("li",[s._v("e2e   e2e测试，目前暂时不接触")]),s._v(" "),n("li",[s._v("unit   unit测试，即单元测试")]),s._v(" "),n("li",[s._v("coverage   存储覆盖率报告的相关目录")]),s._v(" "),n("li",[s._v("fake       存储测试用相关mock数据的目录")]),s._v(" "),n("li",[s._v("specs     测试用例相关代码目录")]),s._v(" "),n("li",[s._v("form   表单模块相关测试用例代码")]),s._v(" "),n("li",[s._v("utils       工具函数库")])]),s._v(" "),n("h2",{attrs:{id:"单元测试学习资料"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#单元测试学习资料"}},[s._v("#")]),s._v(" 单元测试学习资料")]),s._v(" "),n("p",[n("strong",[s._v("单元测试方案主要用到的技术")]),s._v("： jest 测试库，Vue Test Utils库 和sinon库")]),s._v(" "),n("p",[n("strong",[s._v("参考资料有以下几种")])]),s._v(" "),n("ul",[n("li",[n("p",[s._v("jest： https://jestjs.io/zh-Hans/docs/getting-started")])]),s._v(" "),n("li",[n("p",[s._v("vue Test Utils： https://vue-test-utils.vuejs.org/zh/")])]),s._v(" "),n("li",[n("p",[s._v("sinon： https://sinonjs.org/")])]),s._v(" "),n("li",[n("p",[s._v("有关Vue.js测试的全面指南：https://www.manning.com/books/testing-vue-js-applications#toc")])])]),s._v(" "),n("p",[s._v("在开始单元测试之前，可以先了解下什么是测试，测试有什么用？建议开发之前都可以看这篇文章\nhttps://www.manning.com/books/testing-vue-js-applications#toc")]),s._v(" "),n("p",[n("img",{attrs:{src:"https://gitee.com/FIF/pic-beg/raw/master/images/vue/1626857274472-3e661644-28b6-4c37-b817-c4611220965f.png",alt:"img"}})]),s._v(" "),n("p",[n("strong",[s._v("jest.conf.js的配置说明，提供参考了解, 有理解不对的地方还请告知~~~")]),s._v("\n可参考Jest官方文档\nhttps://jestjs.io/zh-Hans/docs/configuration")]),s._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" path "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'path'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nmodule"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("exports "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 根目录")]),s._v("\n  rootDir"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" path"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("resolve")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("__dirname"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'../../'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//Jest用于检测测试文件的全局模式，会去匹配名为 `spec.js`文件")]),s._v("\n  testMatch"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'**/__tests__/**/*.[jt]s?(x)'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'**/?(*.)+(spec).[jt]s?(x)'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 模块使用的文件扩展名数组")]),s._v("\n  moduleFileExtensions"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'js'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'jsx'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'json'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 告诉 Jest 处理 *.vue 文件`")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'vue'")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//支持源代码中相同的 @ -> src 别名!!!!!")]),s._v("\n  moduleNameMapper"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'^@/(.*)$'")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'<rootDir>/src/$1'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'\\\\.(s?css|less)$'")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'identity-obj-proxy'")]),s._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 转换：通过正则配置匹配的文件，交给哪个模块处理`")]),s._v("\n  transform"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 用 babel-jest 处理 js`")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'^.+\\\\.js$'")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'<rootDir>/node_modules/babel-jest'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'.+\\\\.(css|styl|less|sass|scss|png|jpg|ttf|woff|woff2)$'")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'jest-transform-stub'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n   "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//用 vue-jest 处理 *.vue 文件`")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'.*\\\\.(vue)$'")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'<rootDir>/node_modules/vue-jest'")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 忽略")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 在执行测试之前，与所有测试路径匹配的regexp模式字符串数组。如果测试路径与任何模式匹配，它将被跳过")]),s._v("\n  testPathIgnorePatterns"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'<rootDir>/test/e2e'")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Jest应该在快照测试中使用的快照序列化程序模块的路径列表")]),s._v("\n  snapshotSerializers"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'<rootDir>/node_modules/jest-serializer-vue'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  setupFiles"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'<rootDir>/test/unit/setup'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'jest-localstorage-mock'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Jest输出覆盖信息文件的目录")]),s._v("\n  coverageDirectory"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'<rootDir>/test/unit/coverage'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 是否收集测试时的覆盖率信息(由于要带上覆盖率搜集语句重新访问所有执行过的文件,这会让你的测试执行速度被明显减慢)")]),s._v("\n  collectCoverage"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" process"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("env"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("PENV")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("===")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'coverage'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 表明哪些集合的文件是需要收集的,匹配在rootDir下面所有的的文件或目录")]),s._v("\n  collectCoverageFrom"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'src/**/*.{js,vue}'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'!src/main.js'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'!src/router/index.js'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'!**/node_modules/**'")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//Jest生成覆盖报告的形式")]),s._v("\n  coverageReporters"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'html'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'text-summary'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 设置jsdom环境的URL")]),s._v("\n  testURL"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'http://localhost'")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br")])]),n("p",[n("strong",[s._v("运行单元测试命令：")]),s._v("\nnpm run test\nnpm run test:watch  会监听测试用例文件的修改\nnpm run test:coverage  会跑测试覆盖率")]),s._v(" "),n("p",[n("strong",[s._v("vue test utils常用方法:")])]),s._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" wrapper "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mount")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("DyFormTextBox"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" propsData"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" config"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" textBoxData "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" localVue "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" vm "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" wrapper"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("vm\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("ul",[n("li",[s._v("setProps：设置prop参数， 仿造 Prop`")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("wrapper.setProps({ 参数： 值})\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("ol",[n("li",[n("code",[s._v("find: 寻找第一个DOM节点或Vue组件匹配选择器")])])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("wrapper.find('div') \nwrapper.find('#bar')\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("ol",[n("li",[n("code",[s._v("findComponent:： 寻找第一个匹配的Vue组件")])])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("wrapper.findComponent({ name: 'bar' })\nwrapper.findComponent({ ref: 'bar' })\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("ol",[n("li",[n("code",[s._v("模拟用户交互：使用.trigger()来模拟点击")])])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("  const button = wrapper.find('button')\n  button.trigger('click')\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("ol",[n("li",[s._v("引入插件\n"),n("code",[s._v("createLocalVue： 返回一个 Vue 的类供你添加组件、混入和安装插件而不会污染全局的 Vue 类")])])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("import ElementUI from 'element-ui'\nconst localVue = createLocalVue()\nlocalVue.use(ElementUI)\ndescribe('DyFormTextBox', () => {\n  const wrapper = mount(DyFormTextBox, { propsData: { config: textBoxData }, localVue })\n})\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("ol",[n("li",[n("code",[s._v("mocks： 为实例添加额外的属性")])])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("import _g from '@/assets/script/global'\nconst wrapper = mount(DyFormTextBox, {\n  propsData: { config: textBoxData },\n  localVue,\n  mocks: { $_g: _g }\n})\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("ol",[n("li",[n("code",[s._v("provide： 为组件传递用于注入的属性，可查阅 [provide/inject]")])])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("import foreignSelectionData from '../../fake/formModel/foreignSelectionData'\nconst wrapper = mount(dyFormForeignSelection, {\n    propsData: { config: foreignSelectionData.config },\n    provide: {\n      docInfo() {\n        return foreignSelectionData.docInfo\n      },\n      formValidate() {\n        return () => {}\n      }\n    },\n    localVue\n  })\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br")])]),n("ol",[n("li",[s._v("："),n("code",[s._v("emitted： 返回自定义事件")]),s._v("\n文档：https://vue-test-utils.vuejs.org/zh/api/wrapper/#emitted")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("it('input事件可正常触发', async () => {\n    await wrapper.setProps({ value: '单行文本' })\n    expect(vm.childValue).toBe('单行文本')\n    vm.$emit('input')\n    expect(wrapper.emitted().input).toBeTruthy()\n  })\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("p",[n("strong",[s._v("Sinon.JS常用方法")])]),s._v(" "),n("ol",[n("li",[s._v("stubs:  具有预编程行为的功能, 可以是匿名的，也可以包装现有函数。用存根包装现有函数时，不会调用原始函数 （更全用法请参考文档 https://sinonjs.org/releases/v10.0.0/stubs/）\n"),n("code",[s._v("var stub = sinon.stub();")]),s._v("\n创建一个匿名存根函数\n"),n("code",[s._v('var stub = sinon.stub(object, "method");')]),s._v("\n替换 "),n("code",[s._v("object.method")]),s._v(" 为存根函数。如果该属性还不是函数，则抛出异常\n"),n("code",[s._v("stub.resolves(value);")]),s._v("\n使存根返回一个Promise，该Promise解析为提供的值")])]),s._v(" "),n("p",[s._v("外键选择测试用例：获取字段列表数据请求正常")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("import { formModelApi } from '@/api/api'\n const foreignOptions = {\n  list: _g.cloneDeep([{\n    id: '__empty__',\n    relateField: {\n      key_1: {\n        fieldName: '无',\n        fieldValue: '无'\n      }\n    },\n    showFields: {}\n  }])\n}\nconst getFieldsList = sinon.stub(formModelApi, 'getFieldsList')\ngetFieldsList.resolves({\n  status: 200,\n  data: {\n    code: 0,\n    data: foreignOptions\n  }\n})\ndescribe('foreignListPage', () => {\n\tit('获取字段列表数据请求正常', async() => {\n\t\tsetTimeout(() => {\n\t\t  expect(vm.foreignData).toEqual(foreignOptions)\n\t\t}, 0)\n\t })\n})\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br")])]),n("p",[n("strong",[s._v("开发遇到的问题记录1：")])]),s._v(" "),n("ul",[n("li",[s._v("描述问题：外键页面，有引入子组件dmForeignSelection，而子组件是在src\\views\\components\\index.js 全局注册 的。因此在写外键测试用例的时候会报此组件未注册")]),s._v(" "),n("li",[s._v("解决方案：在测试用例注册dmForeignSelection")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("import { createLocalVue } from '@vue/test-utils'\nimport dmForeignSelection from '@/views/components/dmForeignSelection/index'\nconst localVue = createLocalVue()\nlocalVue.component('dmForeignSelection', dmForeignSelection)\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("hr"),s._v(" "),n("p",[s._v("运行端的组件测试用例汇总：")]),s._v(" "),n("table",[n("thead",[n("tr",[n("th",[s._v("组件名")]),s._v(" "),n("th",[s._v("测试用例.js")]),s._v(" "),n("th",[s._v("数量")]),s._v(" "),n("th",[s._v("是否自测通过")])])]),s._v(" "),n("tbody",[n("tr",[n("td",[s._v("单行文本")]),s._v(" "),n("td",[s._v("dyFormTextBox.spec.js")]),s._v(" "),n("td",[s._v("10")]),s._v(" "),n("td",[s._v("npm run test 通过")])]),s._v(" "),n("tr",[n("td",[s._v("外键选择")]),s._v(" "),n("td",[s._v("dyFormForeignSelection.spec.js")]),s._v(" "),n("td",[s._v("4")]),s._v(" "),n("td",[s._v("npm run test 通过")])])])])])}),[],!1,null,null,null);t.default=e.exports}}]);